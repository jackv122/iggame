<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Room Flow - Sequence Diagram</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 2000px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        svg {
            width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .participant {
            font-weight: bold;
            font-size: 32px;
            fill: #333;
        }
        .message {
            font-size: 27px;
            fill: #666;
        }
        .arrow {
            stroke: #007bff;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }
        .arrow-return {
            stroke: #28a745;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }
        .lifeline {
            stroke: #ccc;
            stroke-width: 1;
            stroke-dasharray: 5,5;
        }
        .activation {
            fill: #e3f2fd;
            stroke: #2196f3;
            stroke-width: 1;
        }
        .note {
            fill: #fff3cd;
            stroke: #ffc107;
            stroke-width: 1;
        }
        .note-text {
            font-size: 24px;
            fill: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Join Room Flow - Sequence Diagram</h1>
        <svg viewBox="0 0 2200 1200" xmlns="http://www.w3.org/2000/svg">
            <!-- Define arrow markers -->
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                        refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#007bff" />
                </marker>
            </defs>

            <!-- Participants with quadrupled distance -->
            <rect x="50" y="20" width="150" height="50" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5"/>
            <text x="125" y="50" class="participant" text-anchor="middle">Client</text>

            <rect x="680" y="20" width="150" height="50" fill="#e8f5e8" stroke="#4caf50" stroke-width="2" rx="5"/>
            <text x="755" y="50" class="participant" text-anchor="middle">Proxy</text>

            <rect x="1580" y="20" width="200" height="50" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5"/>
            <text x="1680" y="50" class="participant" text-anchor="middle">Game Server</text>

            <!-- Lifelines -->
            <line x1="125" y1="70" x2="125" y2="1150" class="lifeline"/>
            <line x1="755" y1="70" x2="755" y2="1150" class="lifeline"/>
            <line x1="1680" y1="70" x2="1680" y2="1150" class="lifeline"/>

            <!-- Authentication Flow -->
            <line x1="125" y1="120" x2="755" y2="120" class="arrow"/>
            <text x="440" y="115" class="message" text-anchor="middle">{CMD_AUTH, Token, OperatorId}</text>

            <line x1="755" y1="180" x2="125" y2="180" class="arrow-return"/>
            <text x="440" y="175" class="message" text-anchor="middle">{CMD_AUTH_SUCCESS, Balance, Currency}</text>

            <!-- Join Game Flow -->
            <line x1="125" y1="240" x2="755" y2="240" class="arrow"/>
            <text x="440" y="235" class="message" text-anchor="middle">{CMD_JOIN_GAME}</text>

            <line x1="755" y1="300" x2="125" y2="300" class="arrow-return"/>
            <text x="440" y="295" class="message" text-anchor="middle">{CMD_JOIN_GAME_SUCCESS, limits, RoomIds, GameId}</text>

            <!-- Client selects RoomId -->
            <line x1="125" y1="360" x2="755" y2="360" class="arrow"/>
            <text x="440" y="355" class="message" text-anchor="middle">CMD_JOIN_ROOM</text>
            <text x="440" y="380" class="message" text-anchor="middle">(message: [roomId][json data])</text>

            <!-- Proxy processing -->
            <rect x="725" y="420" width="60" height="50" class="activation"/>
            <text x="755" y="445" class="message" text-anchor="middle">Parse message</text>
            <text x="755" y="470" class="message" text-anchor="middle">roomId = message.substring(0, ROOMID_LENGTH)</text>

            <!-- Proxy to Game Server -->
            <line x1="755" y1="500" x2="1680" y2="500" class="arrow"/>
            <text x="1218" y="495" class="message" text-anchor="middle">{PROXY_CMD_CLIENT_MSG, OperatorId,</text>
            <text x="1218" y="520" class="message" text-anchor="middle">UserId, ConnId, Data}</text>

            <!-- Game Server processing -->
            <rect x="1650" y="560" width="60" height="50" class="activation"/>
            <text x="1680" y="585" class="message" text-anchor="middle">Parse & Process</text>
            <text x="1680" y="610" class="message" text-anchor="middle">join room request</text>

            <!-- Game Server response -->
            <line x1="1680" y1="640" x2="755" y2="640" class="arrow-return"/>
            <text x="1218" y="635" class="message" text-anchor="middle">{CMD_JOIN_ROOM_SUCCESS,</text>
            <text x="1218" y="660" class="message" text-anchor="middle">RoomId, GameId, Balance, RoomInfo}</text>

            <!-- Proxy forwards response -->
            <line x1="755" y1="700" x2="125" y2="700" class="arrow-return"/>
            <text x="440" y="695" class="message" text-anchor="middle">Forward response</text>

            <!-- Notes -->
            <rect x="20" y="760" width="300" height="140" class="note" rx="5"/>
            <text x="30" y="790" class="note-text">Note: Proxy extracts roomId from message</text>
            <text x="30" y="820" class="note-text">and forwards to appropriate game server</text>
            <text x="30" y="850" class="note-text">based on roomId mapping</text>
            <text x="30" y="880" class="note-text">(gameServerConnMap[roomId])</text>

            <rect x="1680" y="760" width="300" height="140" class="note" rx="5"/>
            <text x="1690" y="790" class="note-text">Note: Game server processes</text>
            <text x="1690" y="820" class="note-text">join room request and returns</text>
            <text x="1690" y="850" class="note-text">room information and balance</text>
            <text x="1690" y="880" class="note-text">to the client</text>

            <!-- Flow steps numbering -->
            <circle cx="80" cy="120" r="24" fill="#007bff" stroke="white" stroke-width="2"/>
            <text x="80" y="130" fill="white" font-size="23" text-anchor="middle">1</text>

            <circle cx="80" cy="180" r="24" fill="#28a745" stroke="white" stroke-width="2"/>
            <text x="80" y="190" fill="white" font-size="23" text-anchor="middle">2</text>

            <circle cx="80" cy="240" r="24" fill="#007bff" stroke="white" stroke-width="2"/>
            <text x="80" y="250" fill="white" font-size="23" text-anchor="middle">3</text>

            <circle cx="80" cy="300" r="24" fill="#28a745" stroke="white" stroke-width="2"/>
            <text x="80" y="310" fill="white" font-size="23" text-anchor="middle">4</text>

            <circle cx="80" cy="360" r="24" fill="#007bff" stroke="white" stroke-width="2"/>
            <text x="80" y="370" fill="white" font-size="23" text-anchor="middle">5</text>

            <circle cx="80" cy="500" r="24" fill="#007bff" stroke="white" stroke-width="2"/>
            <text x="80" y="510" fill="white" font-size="23" text-anchor="middle">6</text>

            <circle cx="80" cy="640" r="24" fill="#28a745" stroke="white" stroke-width="2"/>
            <text x="80" y="650" fill="white" font-size="23" text-anchor="middle">7</text>

            <circle cx="80" cy="700" r="24" fill="#28a745" stroke="white" stroke-width="2"/>
            <text x="80" y="710" fill="white" font-size="23" text-anchor="middle">8</text>

            <!-- Legend -->
            <rect x="50" y="920" width="450" height="180" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1" rx="5"/>
            <text x="60" y="950" class="participant">Legend:</text>
            <line x1="60" y1="970" x2="100" y2="970" class="arrow"/>
            <text x="110" y="975" class="message">Request (Client → Server)</text>
            <line x1="60" y1="1000" x2="100" y2="1000" class="arrow-return"/>
            <text x="110" y="1005" class="message">Response (Server → Client)</text>
            <rect x="60" y="1015" width="20" height="15" class="activation"/>
            <text x="90" y="1027" class="message">Processing/Activation</text>
            
            <!-- Additional info -->
            <text x="60" y="1055" class="message" font-size="23">Note: CMD_JOIN_GAME, CMD_PAUSE, CMD_RESUME, CMD_GET_HISTORY</text>
            <text x="60" y="1085" class="message" font-size="23">must be sent with roomID = '000000' as message prefix</text>
            <text x="60" y="1115" class="message" font-size="23">['000000'][json data string]</text>
        </svg>
    </div>
</body>
</html>
